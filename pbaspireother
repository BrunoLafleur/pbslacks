#! /bin/sh

if [ ! -d packages ] ;then
    echo "Script a lancer dans le repertoire contenant packages, packages2 et al."
    exit 1
fi

HOMEDENEMO="http://git.savannah.gnu.org/cgit/denemo.git/snapshot/denemo-master.tar.gz"
SLACKCF="http://slack.conraid.net/repository/slackware64-current"
SLACKDJ="http://www.slackel.gr/repo/x86_64/current/slackel/extra"
SLACKDJ32="http://www.slackel.gr/repo/i486/current/slackel/extra"
SREPO1=cf
SREPO2=dj

xpurgepac () {
    pac="$1"
    LAST=`ls -1t "$pac"*.t?z|head -1`
    for j in "$pac"*.t?z ;do
	if [ "$j" != "$LAST" ] ;then
	    rm -f "$j"
	fi
    done
}

xgetpac () {
    pac="$1"
    dir="$2"
    prof="$3"
    wget -N -A "$pac"'*.t?z' -r -np -nH --cut-dir=$prof "$dir/"
}

cd packages2
if [ ! -d denemo ] ;then
    mkdir denemo
    cp ../pbslacks/denemo.tar.gz denemo
fi
cd denemo
wget -N "$HOMEDENEMO"
cd ../..

cd packages
for i in gimp-script-fu x265 ;do
    xgetpac "$i-" "$SLACKCF/$i" 3
    xpurgepac "$i-"
done
for i in frei0r-plugins libvdpau-va-gl openshot ;do
    xgetpac "$i-" "$SLACKDJ" 5
    xpurgepac "$i-"
done
cd 32
for i in wxPython ;do
    xgetpac "$i-" "$SLACKDJ32" 5
    xpurgepac "$i-"
done
cd ../..
find packages -name 'index.html*' -exec rm -f {} \;

cd packages2
for i in jq lua oniguruma valgrind ;do
    xgetpac "$i-" "$SLACKCF/$i" 3
    xpurgepac "$i-"
done
for i in guile1.8 ;do
    xgetpac "$i-" "$SLACKDJ" 5
    xpurgepac "$i-"
done
cd ..
find packages2 -name 'index.html*' -exec rm -f {} \;

cd packages4
for i in exiftools ;do
    xgetpac "$i-" "$SLACKCF/$i" 3
    xpurgepac "$i-"
done
for i in xcftools ;do
    xgetpac "$i-" "$SLACKDJ" 5
    xpurgepac "$i-"
done
cd ..
find packages4 -name 'index.html*' -exec rm -f {} \;
